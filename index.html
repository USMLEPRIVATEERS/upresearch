<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="UP Research - Grupo de Revis√£o Sistem√°tica e Meta-An√°lise da maior comunidade USMLE do Brasil">
    <meta name="theme-color" content="#1a2847">
    <title>UP Research - USMLE Privateers</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a2847;
            --primary-dark: #0f1829;
            --secondary: #a64d4d;
            --accent: #c85a5a;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-light: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border: #e2e8f0;
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
            color: var(--text-primary);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Auth Container */
        .auth-container {
            max-width: 500px;
            margin: 2rem auto;
            background: white;
            border-radius: var(--radius);
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .logo-section {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            max-width: 150px;
            height: auto;
            margin-bottom: 1rem;
        }

        .logo-section h1 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .tagline {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .social-links a {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .form-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 40, 71, 0.1);
        }

        /* Phone Input */
        .phone-input-container {
            display: flex;
            gap: 0.75rem;
        }

        .country-code-select {
            flex-shrink: 0;
            width: 140px;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .phone-number-inputs {
            display: flex;
            gap: 0.5rem;
            flex: 1;
        }

        .phone-part {
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
        }

        .phone-part:first-child {
            flex: 1;
        }

        .phone-part:nth-child(2) {
            flex: 2;
        }

        .phone-part:last-child {
            flex: 1;
        }

        .helper-text {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        #phone-preview {
            font-weight: 600;
            color: var(--primary);
        }

        .btn-primary {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(26, 40, 71, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .text-link {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .text-link a {
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .alert.error {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }

        .alert.success {
            background: #efe;
            color: #3c3;
            border: 1px solid #cfc;
        }

        /* Dropdown autocomplete */
        .dropdown-container {
            position: relative;
        }

        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 2px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }

        .dropdown-item {
            padding: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: var(--bg-secondary);
        }

        .dropdown-item.add-new {
            color: var(--primary);
            font-weight: 600;
            border-top: 1px solid var(--border);
        }

        /* Dashboard Styles */
        .dashboard {
            min-height: 100vh;
            background: var(--bg-secondary);
        }

        .navbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-logo {
            width: 40px;
            height: 40px;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--primary);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .logout-btn {
            background: var(--error);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .logout-btn:hover {
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text-secondary);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-card h3 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Forms Gallery */
        .forms-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .form-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .form-card h3 {
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .form-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Members Grid */
        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .member-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .member-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .member-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.25rem;
        }

        .member-info h4 {
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .member-role {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .member-details {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .member-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .member-detail span:first-child {
            color: var(--text-secondary);
        }

        .member-detail span:last-child {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Research Cards */
        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .research-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
        }

        .research-header {
            margin-bottom: 1rem;
        }

        .research-header h3 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .research-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .tag.status {
            background: var(--success);
            color: white;
        }

        .tag.league {
            background: var(--primary);
            color: white;
        }

        .tag.specialty {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        /* Filters */
        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Live Card */
        .live-section {
            background: white;
            padding: 2rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .live-section h2 {
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .live-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem;
            border-radius: var(--radius);
            color: white;
        }

        .live-status {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .live-card h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .live-card p {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }

        .live-card a {
            color: white;
            font-weight: 600;
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-container {
                margin: 1rem;
                padding: 1.5rem;
            }

            .country-code-select {
                width: 100%;
            }

            .phone-input-container {
                flex-direction: column;
            }

            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
            }

            .container {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .btn-cancel {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-cancel:hover {
            background: var(--bg-secondary);
        }

        .btn-submit {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-submit:hover {
            background: var(--primary-dark);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .modal {
                padding: 1rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .modal-footer {
                flex-direction: column;
            }

            .btn-cancel,
            .btn-submit {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Page -->
        <div id="login-page" class="page active">
            <div class="auth-container">
                <div class="logo-section">
                    <h1>UP Research</h1>
                    <p class="tagline">Grupo de Revis√£o Sistem√°tica e Meta-An√°lise</p>
                    <p class="subtitle">Maior comunidade USMLE do Brasil üá∫üá∏</p>
                    <div class="social-links">
                        <a href="https://twitter.com/upresearchusmle" target="_blank">@upresearchusmle</a>
                        <a href="https://instagram.com/usmleprivateers" target="_blank">@usmleprivateers</a>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Login</h2>
                    <div id="alert-box" class="alert" style="display: none;"></div>
                    
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-email">E-mail ou Usu√°rio *</label>
                            <input type="text" id="login-email" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Senha *</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="btn-primary">Entrar</button>
                    </form>

                    <div class="text-link">
                        N√£o tem conta? <a href="#" onclick="showPage('signup-page'); return false;">Criar Conta</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signup Page -->
        <div id="signup-page" class="page">
            <div class="auth-container">
                <div class="logo-section">
                    <h1>UP Research</h1>
                    <p class="tagline">Cadastro de Novo Membro</p>
                </div>

                <div class="form-section">
                    <h2>Criar Conta</h2>
                    <div id="signup-alert" class="alert" style="display: none;"></div>
                    
                    <form id="signup-form">
                        <div class="form-group">
                            <label for="name">Nome Completo *</label>
                            <input type="text" id="name" required>
                        </div>

                        <div class="form-group">
                            <label for="whatsapp">WhatsApp *</label>
                            <div class="phone-input-container">
                                <select id="country-code" class="country-code-select" required>
                                    <optgroup label="Principais">
                                        <option value="+1">üá∫üá∏ EUA (+1)</option>
                                        <option value="+55" selected>üáßüá∑ Brasil (+55)</option>
                                    </optgroup>
                                </select>
                                <div class="phone-number-inputs">
                                    <input type="tel" id="phone-area" class="phone-part" placeholder="DDD" maxlength="2" required>
                                    <input type="tel" id="phone-first" class="phone-part" placeholder="99999" maxlength="5" required>
                                    <input type="tel" id="phone-second" class="phone-part" placeholder="9999" maxlength="4" required>
                                </div>
                            </div>
                            <small class="helper-text" id="phone-preview"></small>
                            <input type="hidden" id="whatsapp" required>
                        </div>

                        <div class="form-group">
                            <label for="medical-school">Faculdade de Medicina *</label>
                            <div class="dropdown-container">
                                <input type="text" id="medical-school-input" placeholder="Digite para buscar..." required>
                                <div id="dropdown-list" class="dropdown-list"></div>
                            </div>
                            <input type="hidden" id="medical-school" required>
                        </div>

                        <div class="form-group">
                            <label for="student-status">Status *</label>
                            <select id="student-status" required>
                                <option value="">Selecione...</option>
                                <option value="studying">Estudante de Medicina</option>
                                <option value="graduated">M√©dico Formado</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="email">E-mail *</label>
                            <input type="email" id="email" required>
                        </div>

                        <div class="form-group">
                            <label for="password">Senha *</label>
                            <input type="password" id="password" minlength="6" required>
                        </div>

                        <div class="form-group">
                            <label for="confirm-password">Confirmar Senha *</label>
                            <input type="password" id="confirm-password" minlength="6" required>
                        </div>

                        <button type="submit" class="btn-primary">Criar Conta</button>
                    </form>

                    <div class="text-link">
                        J√° tem conta? <a href="#" onclick="showPage('login-page'); return false;">Fazer Login</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pending Approval Page -->
        <div id="pending-approval-page" class="page">
            <div class="auth-container">
                <div class="logo-section">
                    <h1>UP Research</h1>
                </div>

                <div class="form-section" style="text-align: center;">
                    <h2 style="color: var(--secondary);">‚è≥ Aguardando Aprova√ß√£o</h2>
                    <p style="margin: 1.5rem 0;">Seu cadastro foi realizado com sucesso!</p>
                    
                    <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; text-align: left;">
                        <p style="font-weight: 600; margin-bottom: 1rem;">Para acessar a plataforma:</p>
                        <ol>
                            <li style="margin-bottom: 0.75rem;">Aguarde a aprova√ß√£o do Representante da sua institui√ß√£o</li>
                            <li>Voc√™ receber√° acesso assim que for aprovado</li>
                        </ol>
                    </div>

                    <button class="btn-secondary" onclick="logout()" style="width: auto; padding: 0.75rem 2rem; margin-top: 1rem;">Sair</button>
                </div>
            </div>
        </div>

        <!-- Loading Page -->
        <div id="loading-page" class="page">
            <div class="auth-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando...</p>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="page">
            <!-- Navbar -->
            <nav class="navbar">
                <div class="nav-brand">
                    <span>UP Research</span>
                </div>
                <div class="nav-menu">
                    <a class="nav-link active" onclick="showDashboardPage('home-page')">Home</a>
                    <a class="nav-link" onclick="showDashboardPage('members-page')">Membros</a>
                    <a class="nav-link" onclick="showDashboardPage('research-page')">Pesquisas</a>
                </div>
                <div class="nav-user">
                    <div class="user-avatar" id="user-avatar">M</div>
                    <span id="user-name-nav">Usu√°rio</span>
                    <button class="logout-btn" onclick="logout()">Sair</button>
                </div>
            </nav>

            <!-- Home Page -->
            <div id="home-page" class="dashboard-page active">
                <div class="container">
                    <div class="page-header">
                        <h1>Bem-vindo, <span id="user-name-home">Usu√°rio</span>!</h1>
                        <p>Acompanhe suas atividades no UP Research</p>
                    </div>

                    <!-- Stats -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Pesquisas</h3>
                            <div class="stat-value" id="stat-research">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Membros</h3>
                            <div class="stat-value" id="stat-members">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Cargo</h3>
                            <div class="stat-value" id="stat-role" style="font-size: 1.5rem;">Membro</div>
                        </div>
                        <div class="stat-card">
                            <h3>Deadlines</h3>
                            <div class="stat-value" id="stat-deadlines">0</div>
                        </div>
                    </div>

                    <!-- Live Section -->
                    <div class="live-section">
                        <h2>üì∫ Pr√≥xima Live</h2>
                        <div class="live-card">
                            <div class="live-status">Em breve</div>
                            <h4>Aguardando programa√ß√£o</h4>
                            <p>O link ser√° liberado por um superior ap√≥s a <a href="#" onclick="alert('Funcionalidade em desenvolvimento!'); return false;">atualiza√ß√£o dos relat√≥rios</a></p>
                        </div>
                    </div>

                    <!-- Forms Gallery -->
                    <h2 style="margin-bottom: 1rem;">üìã Formul√°rios</h2>
                    <div class="forms-gallery">
                        <div class="form-card" onclick="openFormModal('whatsapp')">
                            <h3>üí¨ WhatsApp</h3>
                            <p>Solicitar entrada no grupo WhatsApp da institui√ß√£o</p>
                        </div>
                        <div class="form-card" onclick="openFormModal('duvidas')">
                            <h3>‚ùì D√∫vidas</h3>
                            <p>Enviar d√∫vidas para os representantes</p>
                        </div>
                        <div class="form-card" onclick="openFormModal('relatorios')">
                            <h3>üìä Relat√≥rios</h3>
                            <p>Atualizar progresso das pesquisas</p>
                        </div>
                        <div class="form-card" onclick="openFormModal('promocao')">
                            <h3>‚¨ÜÔ∏è Promo√ß√£o</h3>
                            <p>Solicitar mudan√ßa de cargo</p>
                        </div>
                        <div class="form-card" onclick="openFormModal('denuncia')">
                            <h3>üö® Den√∫ncia</h3>
                            <p>Den√∫ncia an√¥nima</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Members Page -->
            <div id="members-page" class="dashboard-page" style="display: none;">
                <div class="container">
                    <div class="page-header">
                        <h1>üë• Membros da Institui√ß√£o</h1>
                        <p id="institution-name">Carregando...</p>
                    </div>

                    <!-- Filters -->
                    <div class="filters">
                        <div class="filter-group">
                            <label>Buscar</label>
                            <input type="text" id="search-members" placeholder="Nome ou email...">
                        </div>
                        <div class="filter-group">
                            <label>Cargo</label>
                            <select id="filter-role">
                                <option value="">Todos</option>
                                <option value="FUNDADOR">Fundador</option>
                                <option value="CHEFE">Chefe</option>
                                <option value="VETERANO">Veterano</option>
                                <option value="REPRESENTANTE">Representante</option>
                                <option value="MEMBRO">Membro</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Liga</label>
                            <select id="filter-league">
                                <option value="">Todas</option>
                                <option value="clinica">Cl√≠nica</option>
                                <option value="cirurgia">Cirurgia</option>
                            </select>
                        </div>
                    </div>

                    <!-- Members Grid -->
                    <div id="members-grid" class="members-grid">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Carregando membros...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Research Page -->
            <div id="research-page" class="dashboard-page" style="display: none;">
                <div class="container">
                    <div class="page-header">
                        <h1>üî¨ Pesquisas</h1>
                        <p>Projetos de revis√£o sistem√°tica da institui√ß√£o</p>
                    </div>

                    <!-- Filters -->
                    <div class="filters">
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="filter-status">
                                <option value="">Todos</option>
                                <option value="Em Progresso">Em Progresso</option>
                                <option value="Finalizada">Finalizada</option>
                                <option value="Arquivada">Arquivada</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Liga</label>
                            <select id="filter-research-league">
                                <option value="">Todas</option>
                                <option value="clinica">Cl√≠nica</option>
                                <option value="cirurgia">Cirurgia</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Aceitando Coautores</label>
                            <select id="filter-coauthors">
                                <option value="">Todos</option>
                                <option value="true">Sim</option>
                                <option value="false">N√£o</option>
                            </select>
                        </div>
                    </div>

                    <!-- Research Grid -->
                    <div id="research-grid" class="research-grid">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Carregando pesquisas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Modals -->
        <!-- WhatsApp Modal -->
        <div id="modal-whatsapp" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üí¨ Solicitar Entrada no WhatsApp</h2>
                    <button class="modal-close" onclick="closeFormModal('whatsapp')">√ó</button>
                </div>
                <form id="form-whatsapp" onsubmit="submitForm(event, 'whatsapp')">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Institui√ß√£o</label>
                            <input type="text" id="whatsapp-institution" readonly>
                        </div>
                        <div class="form-group">
                            <label>Seu Nome</label>
                            <input type="text" id="whatsapp-name" readonly>
                        </div>
                        <div class="form-group">
                            <label>Por que deseja entrar no grupo?</label>
                            <textarea id="whatsapp-reason" rows="4" required placeholder="Explique sua motiva√ß√£o..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeFormModal('whatsapp')">Cancelar</button>
                        <button type="submit" class="btn-submit">Enviar Solicita√ß√£o</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- D√∫vidas Modal -->
        <div id="modal-duvidas" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚ùì Enviar D√∫vida</h2>
                    <button class="modal-close" onclick="closeFormModal('duvidas')">√ó</button>
                </div>
                <form id="form-duvidas" onsubmit="submitForm(event, 'duvidas')">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Assunto *</label>
                            <select id="duvidas-subject" required>
                                <option value="">Selecione...</option>
                                <option value="pesquisa">D√∫vida sobre Pesquisa</option>
                                <option value="metodologia">Metodologia de Revis√£o</option>
                                <option value="prazos">Prazos e Deadlines</option>
                                <option value="publicacao">Processo de Publica√ß√£o</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Sua D√∫vida *</label>
                            <textarea id="duvidas-question" rows="5" required placeholder="Descreva sua d√∫vida em detalhes..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeFormModal('duvidas')">Cancelar</button>
                        <button type="submit" class="btn-submit">Enviar D√∫vida</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Relat√≥rios Modal -->
        <div id="modal-relatorios" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üìä Atualizar Relat√≥rio de Pesquisa</h2>
                    <button class="modal-close" onclick="closeFormModal('relatorios')">√ó</button>
                </div>
                <form id="form-relatorios" onsubmit="submitForm(event, 'relatorios')">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>T√≠tulo da Pesquisa *</label>
                            <input type="text" id="relatorios-title" required placeholder="Digite o t√≠tulo da sua pesquisa...">
                        </div>
                        <div class="form-group">
                            <label>Status Atual *</label>
                            <select id="relatorios-status" required>
                                <option value="">Selecione...</option>
                                <option value="planejamento">Planejamento</option>
                                <option value="coleta">Coleta de Dados</option>
                                <option value="analise">An√°lise</option>
                                <option value="escrita">Escrita do Manuscrito</option>
                                <option value="revisao">Em Revis√£o</option>
                                <option value="submissao">Submetido</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Progresso (%) *</label>
                            <input type="number" id="relatorios-progress" min="0" max="100" required>
                        </div>
                        <div class="form-group">
                            <label>Atualiza√ß√µes e Observa√ß√µes *</label>
                            <textarea id="relatorios-notes" rows="5" required placeholder="Descreva o progresso, dificuldades, pr√≥ximos passos..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeFormModal('relatorios')">Cancelar</button>
                        <button type="submit" class="btn-submit">Enviar Relat√≥rio</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Promo√ß√£o Modal -->
        <div id="modal-promocao" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚¨ÜÔ∏è Solicitar Promo√ß√£o de Cargo</h2>
                    <button class="modal-close" onclick="closeFormModal('promocao')">√ó</button>
                </div>
                <form id="form-promocao" onsubmit="submitForm(event, 'promocao')">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Cargo Atual</label>
                            <input type="text" id="promocao-current" readonly>
                        </div>
                        <div class="form-group">
                            <label>Cargo Desejado *</label>
                            <select id="promocao-desired" required>
                                <option value="">Selecione...</option>
                                <option value="ESCRIBA">Escriba</option>
                                <option value="REPRESENTANTE">Representante</option>
                                <option value="VETERANO">Veterano</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Justificativa *</label>
                            <textarea id="promocao-justification" rows="6" required placeholder="Por que voc√™ merece esta promo√ß√£o? Descreva suas contribui√ß√µes, pesquisas, lideran√ßa..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeFormModal('promocao')">Cancelar</button>
                        <button type="submit" class="btn-submit">Enviar Solicita√ß√£o</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Den√∫ncia Modal -->
        <div id="modal-denuncia" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üö® Den√∫ncia An√¥nima</h2>
                    <button class="modal-close" onclick="closeFormModal('denuncia')">√ó</button>
                </div>
                <form id="form-denuncia" onsubmit="submitForm(event, 'denuncia')">
                    <div class="modal-body">
                        <p style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                            ‚ö†Ô∏è Esta den√∫ncia √© completamente an√¥nima. N√£o coletamos seu nome ou email.
                        </p>
                        <div class="form-group">
                            <label>Tipo de Den√∫ncia *</label>
                            <select id="denuncia-type" required>
                                <option value="">Selecione...</option>
                                <option value="plagio">Pl√°gio ou M√° Conduta Cient√≠fica</option>
                                <option value="assedio">Ass√©dio ou Bullying</option>
                                <option value="discriminacao">Discrimina√ß√£o</option>
                                <option value="abuso">Abuso de Poder</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o dos Fatos *</label>
                            <textarea id="denuncia-description" rows="6" required placeholder="Descreva o que aconteceu com o m√°ximo de detalhes poss√≠vel..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Institui√ß√£o Envolvida (opcional)</label>
                            <input type="text" id="denuncia-institution" placeholder="Qual institui√ß√£o est√° relacionada?">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-cancel" onclick="closeFormModal('denuncia')">Cancelar</button>
                        <button type="submit" class="btn-submit">Enviar Den√∫ncia</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // URL do Google Apps Script
        const API_URL = 'https://script.google.com/macros/s/AKfycbyJTnV0BkePPNx0UM5QF7tn7HJVhHbnrjK5ZI1k4Oo9QQKlpuHssoK9LouhWxldpi0q/exec';

        // Current User
        let currentUser = null;

        // Role Colors
        const ROLE_COLORS = {
            'FUNDADOR': '#0f1829',
            'SENIOR': '#8b3838',
            'CHEFE': '#a64d4d',
            'VETERANO': '#1a2847',
            'REPRESENTANTE': '#2d4563',
            'ESCRIBA': '#4a6b8a',
            'MEMBRO': '#6b8cae'
        };

        // Utility Functions
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function showAlert(elementId, message, type = 'error') {
            const alert = document.getElementById(elementId);
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function logout() {
            localStorage.removeItem('upresearch_user');
            showPage('login-page');
        }

        // Phone Input Setup
        function setupPhoneInput() {
            const countryCode = document.getElementById('country-code');
            const phoneArea = document.getElementById('phone-area');
            const phoneFirst = document.getElementById('phone-first');
            const phoneSecond = document.getElementById('phone-second');
            const phonePreview = document.getElementById('phone-preview');
            const whatsappHidden = document.getElementById('whatsapp');

            function updatePlaceholders() {
                const country = countryCode.value;
                if (country === '+55') {
                    phoneArea.placeholder = 'DDD';
                    phoneArea.maxLength = 2;
                    phoneFirst.placeholder = '99999';
                    phoneFirst.maxLength = 5;
                    phoneSecond.placeholder = '9999';
                    phoneSecond.maxLength = 4;
                } else if (country === '+1') {
                    phoneArea.placeholder = 'Area';
                    phoneArea.maxLength = 3;
                    phoneFirst.placeholder = '999';
                    phoneFirst.maxLength = 3;
                    phoneSecond.placeholder = '9999';
                    phoneSecond.maxLength = 4;
                }
                phoneArea.value = '';
                phoneFirst.value = '';
                phoneSecond.value = '';
                updatePreview();
            }

            function updatePreview() {
                const country = countryCode.value;
                const area = phoneArea.value;
                const first = phoneFirst.value;
                const second = phoneSecond.value;

                let formatted = '';
                let fullNumber = '';

                if (country === '+55') {
                    if (area || first || second) {
                        formatted = country;
                        if (area) formatted += ` (${area})`;
                        if (first) formatted += ` ${first}`;
                        if (second) formatted += `-${second}`;
                        if (area && first && second) {
                            fullNumber = `${country}${area}${first}${second}`;
                        }
                    }
                } else if (country === '+1') {
                    if (area || first || second) {
                        formatted = country;
                        if (area) formatted += ` (${area})`;
                        if (first) formatted += ` ${first}`;
                        if (second) formatted += `-${second}`;
                        if (area && first && second) {
                            fullNumber = `${country}${area}${first}${second}`;
                        }
                    }
                }

                phonePreview.textContent = formatted || 'Preview do n√∫mero';
                whatsappHidden.value = fullNumber;
            }

            function autoFocus(current, next) {
                if (current.value.length === parseInt(current.maxLength) && next) {
                    next.focus();
                }
            }

            countryCode.addEventListener('change', updatePlaceholders);
            
            [phoneArea, phoneFirst, phoneSecond].forEach(input => {
                input.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '');
                    updatePreview();
                });

                input.addEventListener('keyup', () => {
                    const inputs = [phoneArea, phoneFirst, phoneSecond];
                    const currentIndex = inputs.indexOf(input);
                    if (currentIndex < inputs.length - 1) {
                        autoFocus(input, inputs[currentIndex + 1]);
                    }
                });
            });

            updatePlaceholders();
        }

        // Medical School Autocomplete
        let medicalSchools = [];

        async function loadMedicalSchools() {
            try {
                const response = await fetch(`${API_URL}?action=getMedicalSchools`);
                const result = await response.json();
                if (result.status === 'success') {
                    medicalSchools = result.data.schools || [];
                }
            } catch (error) {
                console.error('Erro ao carregar faculdades:', error);
            }
        }

        function setupMedicalSchoolAutocomplete() {
            const input = document.getElementById('medical-school-input');
            const dropdown = document.getElementById('dropdown-list');
            const hidden = document.getElementById('medical-school');

            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                hidden.value = '';

                if (value.length < 2) {
                    dropdown.style.display = 'none';
                    return;
                }

                const filtered = medicalSchools.filter(school => 
                    school.toLowerCase().includes(value)
                );

                if (filtered.length > 0 || value.length > 3) {
                    dropdown.innerHTML = filtered.map(school => `
                        <div class="dropdown-item" onclick="selectSchool('${school}')">${school}</div>
                    `).join('');

                    if (filtered.length === 0) {
                        dropdown.innerHTML += `
                            <div class="dropdown-item add-new" onclick="addNewSchool()">
                                + Adicionar "${input.value}"
                            </div>
                        `;
                    }

                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            });

            input.addEventListener('focus', function() {
                if (this.value.length >= 2) {
                    this.dispatchEvent(new Event('input'));
                }
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dropdown-container')) {
                    dropdown.style.display = 'none';
                }
            });
        }

        function selectSchool(school) {
            document.getElementById('medical-school-input').value = school;
            document.getElementById('medical-school').value = school;
            document.getElementById('dropdown-list').style.display = 'none';
        }

        async function addNewSchool() {
            const input = document.getElementById('medical-school-input');
            const name = input.value.trim();

            if (!name.match(/^.+\s\(.+\)$/)) {
                alert('Por favor, adicione a faculdade no formato: Nome Completo (ABREVIA√á√ÉO)');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('action', 'addMedicalSchool');
                formData.append('name', name);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    medicalSchools.push(name);
                    selectSchool(name);
                    alert('Faculdade adicionada com sucesso!');
                } else {
                    alert(result.message);
                }
            } catch (error) {
                alert('Erro ao adicionar faculdade. Tente novamente.');
                console.error(error);
            }
        }

        // Login Handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            showPage('loading-page');

            try {
                const formData = new FormData();
                formData.append('action', 'login');
                formData.append('email', email);
                formData.append('password', password);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    localStorage.setItem('upresearch_user', JSON.stringify(result.data.user));
                    currentUser = result.data.user;
                    
                    if (result.data.user.approved === false) {
                        showPage('pending-approval-page');
                    } else {
                        loadDashboard();
                    }
                } else {
                    showPage('login-page');
                    showAlert('alert-box', result.message, 'error');
                }
            } catch (error) {
                showPage('login-page');
                showAlert('alert-box', 'Erro ao conectar com o servidor', 'error');
                console.error(error);
            }
        });

        // Signup Handler
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            const whatsapp = document.getElementById('whatsapp').value;
            const medicalSchool = document.getElementById('medical-school').value;

            if (password !== confirmPassword) {
                showAlert('signup-alert', 'As senhas n√£o coincidem!', 'error');
                return;
            }

            if (!whatsapp) {
                showAlert('signup-alert', 'Por favor, preencha o WhatsApp completo!', 'error');
                return;
            }

            if (!medicalSchool) {
                showAlert('signup-alert', 'Por favor, selecione uma faculdade!', 'error');
                return;
            }

            showPage('loading-page');

            try {
                const formData = new FormData();
                formData.append('action', 'signup');
                formData.append('name', document.getElementById('name').value);
                formData.append('whatsapp', whatsapp);
                formData.append('email', document.getElementById('email').value);
                formData.append('password', password);
                formData.append('medicalSchool', medicalSchool);
                formData.append('studentStatus', document.getElementById('student-status').value);

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showPage('pending-approval-page');
                } else {
                    showPage('signup-page');
                    showAlert('signup-alert', result.message, 'error');
                }
            } catch (error) {
                showPage('signup-page');
                showAlert('signup-alert', 'Erro ao conectar com o servidor', 'error');
                console.error(error);
            }
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', async () => {
            await loadMedicalSchools();
            setupPhoneInput();
            setupMedicalSchoolAutocomplete();

            // Check if user is logged in
            const userStr = localStorage.getItem('upresearch_user');
            if (userStr) {
                currentUser = JSON.parse(userStr);
                if (currentUser.approved === false) {
                    showPage('pending-approval-page');
                } else {
                    loadDashboard();
                }
            }
        });

        // Dashboard Functions
        function loadDashboard() {
            showPage('dashboard');
            
            // Set user info
            document.getElementById('user-name-nav').textContent = currentUser.name.split(' ')[0];
            document.getElementById('user-name-home').textContent = currentUser.name.split(' ')[0];
            document.getElementById('user-avatar').textContent = currentUser.name[0].toUpperCase();
            document.getElementById('user-avatar').style.background = ROLE_COLORS[currentUser.role] || ROLE_COLORS['MEMBRO'];
            document.getElementById('stat-role').textContent = currentUser.role;
            document.getElementById('stat-deadlines').textContent = currentUser.deadlinesMissed || 0;
            
            // Load data
            loadMembers();
            loadResearch();
        }

        function showDashboardPage(pageId) {
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show page
            document.querySelectorAll('.dashboard-page').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';
        }

        async function loadMembers() {
            try {
                const response = await fetch(`${API_URL}?action=getMembers&institution=${encodeURIComponent(currentUser.medicalSchool)}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const members = result.data.members;
                    document.getElementById('stat-members').textContent = members.length;
                    document.getElementById('institution-name').textContent = currentUser.medicalSchool;
                    
                    displayMembers(members);
                } else {
                    document.getElementById('members-grid').innerHTML = '<div class="empty-state"><p>Erro ao carregar membros</p></div>';
                }
            } catch (error) {
                console.error('Erro ao carregar membros:', error);
                document.getElementById('members-grid').innerHTML = '<div class="empty-state"><p>Erro ao carregar membros</p></div>';
            }
        }

        function displayMembers(members) {
            const grid = document.getElementById('members-grid');
            
            if (members.length === 0) {
                grid.innerHTML = '<div class="empty-state"><p>Nenhum membro encontrado</p></div>';
                return;
            }

            grid.innerHTML = members.map(member => `
                <div class="member-card">
                    <div class="member-header">
                        <div class="member-avatar" style="background: ${ROLE_COLORS[member.role] || ROLE_COLORS['MEMBRO']}">
                            ${member.name[0].toUpperCase()}
                        </div>
                        <div class="member-info">
                            <h4>${member.name}</h4>
                            <span class="member-role" style="background: ${ROLE_COLORS[member.role] || ROLE_COLORS['MEMBRO']}">${member.role}</span>
                        </div>
                    </div>
                    <div class="member-details">
                        <div class="member-detail">
                            <span>Email:</span>
                            <span>${member.email}</span>
                        </div>
                        ${member.league ? `
                        <div class="member-detail">
                            <span>Liga:</span>
                            <span>${member.league === 'clinica' ? 'Cl√≠nica' : 'Cirurgia'}</span>
                        </div>
                        ` : ''}
                        ${member.specialty ? `
                        <div class="member-detail">
                            <span>Especialidade:</span>
                            <span>${member.specialty}</span>
                        </div>
                        ` : ''}
                        ${member.deadlinesMissed > 0 ? `
                        <div class="member-detail">
                            <span>Deadlines:</span>
                            <span style="color: var(--error)">‚ùå ${member.deadlinesMissed}</span>
                        </div>
                        ` : ''}
                        <div class="member-detail">
                            <span>WhatsApp:</span>
                            <span><a href="https://wa.me/${member.whatsapp}" target="_blank" style="color: var(--success)">üí¨ Conversar</a></span>
                        </div>
                    </div>
                </div>
            `).join('');

            // Setup filters
            setupMemberFilters(members);
        }

        function setupMemberFilters(members) {
            const searchInput = document.getElementById('search-members');
            const roleFilter = document.getElementById('filter-role');
            const leagueFilter = document.getElementById('filter-league');

            function applyFilters() {
                const search = searchInput.value.toLowerCase();
                const role = roleFilter.value;
                const league = leagueFilter.value;

                const filtered = members.filter(m => {
                    const matchSearch = !search || m.name.toLowerCase().includes(search) || m.email.toLowerCase().includes(search);
                    const matchRole = !role || m.role === role;
                    const matchLeague = !league || m.league === league;
                    return matchSearch && matchRole && matchLeague;
                });

                displayMembers(filtered);
            }

            searchInput.addEventListener('input', applyFilters);
            roleFilter.addEventListener('change', applyFilters);
            leagueFilter.addEventListener('change', applyFilters);
        }

        async function loadResearch() {
            try {
                const response = await fetch(`${API_URL}?action=getResearch&institution=${encodeURIComponent(currentUser.medicalSchool)}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const research = result.data.research;
                    document.getElementById('stat-research').textContent = research.length;
                    
                    displayResearch(research);
                } else {
                    document.getElementById('research-grid').innerHTML = '<div class="empty-state"><p>Erro ao carregar pesquisas</p></div>';
                }
            } catch (error) {
                console.error('Erro ao carregar pesquisas:', error);
                document.getElementById('research-grid').innerHTML = '<div class="empty-state"><p>Erro ao carregar pesquisas</p></div>';
            }
        }

        function displayResearch(research) {
            const grid = document.getElementById('research-grid');
            
            if (research.length === 0) {
                grid.innerHTML = '<div class="empty-state"><p>Nenhuma pesquisa encontrada</p></div>';
                return;
            }

            grid.innerHTML = research.map(r => `
                <div class="research-card">
                    <div class="research-header">
                        <h3>${r.title}</h3>
                    </div>
                    <div class="research-tags">
                        <span class="tag status">${r.status}</span>
                        <span class="tag league">${r.league === 'clinica' ? 'Cl√≠nica' : 'Cirurgia'}</span>
                        ${r.specialty ? `<span class="tag specialty">${r.specialty}</span>` : ''}
                        ${r.acceptingCoauthors ? '<span class="tag" style="background: var(--success); color: white">Aceitando Coautores</span>' : ''}
                    </div>
                    ${r.description ? `<p style="color: var(--text-secondary); margin-bottom: 1rem;">${r.description}</p>` : ''}
                    <div class="member-details">
                        <div class="member-detail">
                            <span>Primeiro Autor:</span>
                            <span>${r.firstAuthor}</span>
                        </div>
                        ${r.coauthors && r.coauthors.length > 0 ? `
                        <div class="member-detail">
                            <span>Coautores:</span>
                            <span>${r.coauthors.length}</span>
                        </div>
                        ` : ''}
                        <div class="member-detail">
                            <span>In√≠cio:</span>
                            <span>${new Date(r.startDate).toLocaleDateString('pt-BR')}</span>
                        </div>
                        ${r.whatsappLink ? `
                        <div class="member-detail" style="margin-top: 1rem;">
                            <a href="${r.whatsappLink}" target="_blank" class="btn-primary" style="display: inline-block; padding: 0.5rem 1rem; text-align: center; text-decoration: none; border-radius: 6px;">üí¨ Contatar Autor</a>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            // Setup filters
            setupResearchFilters(research);
        }

        function setupResearchFilters(research) {
            const statusFilter = document.getElementById('filter-status');
            const leagueFilter = document.getElementById('filter-research-league');
            const coauthorsFilter = document.getElementById('filter-coauthors');

            function applyFilters() {
                const status = statusFilter.value;
                const league = leagueFilter.value;
                const coauthors = coauthorsFilter.value;

                const filtered = research.filter(r => {
                    const matchStatus = !status || r.status === status;
                    const matchLeague = !league || r.league === league;
                    const matchCoauthors = !coauthors || r.acceptingCoauthors.toString() === coauthors;
                    return matchStatus && matchLeague && matchCoauthors;
                });

                displayResearch(filtered);
            }

            statusFilter.addEventListener('change', applyFilters);
            leagueFilter.addEventListener('change', applyFilters);
            coauthorsFilter.addEventListener('change', applyFilters);
        }

        function openFormModal(formType) {
            const modal = document.getElementById(`modal-${formType}`);
            if (!modal) return;

            // Pre-fill user data
            if (formType === 'whatsapp') {
                document.getElementById('whatsapp-institution').value = currentUser.medicalSchool;
                document.getElementById('whatsapp-name').value = currentUser.name;
            } else if (formType === 'promocao') {
                document.getElementById('promocao-current').value = currentUser.role;
            }

            modal.classList.add('active');
        }

        function closeFormModal(formType) {
            const modal = document.getElementById(`modal-${formType}`);
            if (!modal) return;

            modal.classList.remove('active');

            // Reset form
            const form = document.getElementById(`form-${formType}`);
            if (form) form.reset();
        }

        async function submitForm(event, formType) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = form.querySelector('.btn-submit');
            
            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            try {
                let formData = new FormData();
                formData.append('action', 'submitForm');
                formData.append('type', formType);
                formData.append('userId', currentUser.id);

                // Collect form data based on type
                let data = {};
                
                if (formType === 'whatsapp') {
                    data = {
                        institution: document.getElementById('whatsapp-institution').value,
                        name: document.getElementById('whatsapp-name').value,
                        reason: document.getElementById('whatsapp-reason').value
                    };
                } else if (formType === 'duvidas') {
                    data = {
                        subject: document.getElementById('duvidas-subject').value,
                        question: document.getElementById('duvidas-question').value,
                        userName: currentUser.name,
                        userEmail: currentUser.email
                    };
                } else if (formType === 'relatorios') {
                    data = {
                        title: document.getElementById('relatorios-title').value,
                        status: document.getElementById('relatorios-status').value,
                        progress: document.getElementById('relatorios-progress').value,
                        notes: document.getElementById('relatorios-notes').value,
                        userName: currentUser.name
                    };
                } else if (formType === 'promocao') {
                    data = {
                        currentRole: document.getElementById('promocao-current').value,
                        desiredRole: document.getElementById('promocao-desired').value,
                        justification: document.getElementById('promocao-justification').value,
                        userName: currentUser.name,
                        userEmail: currentUser.email
                    };
                } else if (formType === 'denuncia') {
                    data = {
                        type: document.getElementById('denuncia-type').value,
                        description: document.getElementById('denuncia-description').value,
                        institution: document.getElementById('denuncia-institution').value || 'N√£o informado'
                    };
                }

                formData.append('data', JSON.stringify(data));

                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert(`‚úÖ ${getFormSuccessMessage(formType)}`);
                    closeFormModal(formType);
                } else {
                    alert(`‚ùå Erro: ${result.message}`);
                }
            } catch (error) {
                alert('‚ùå Erro ao enviar formul√°rio. Tente novamente.');
                console.error(error);
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = getFormButtonText(formType);
            }
        }

        function getFormSuccessMessage(formType) {
            const messages = {
                whatsapp: 'Solicita√ß√£o enviada! O representante avaliar√° em breve.',
                duvidas: 'D√∫vida enviada! Voc√™ receber√° resposta em breve.',
                relatorios: 'Relat√≥rio atualizado com sucesso!',
                promocao: 'Solicita√ß√£o de promo√ß√£o enviada! Aguarde avalia√ß√£o.',
                denuncia: 'Den√∫ncia registrada de forma an√¥nima. Obrigado.'
            };
            return messages[formType] || 'Formul√°rio enviado com sucesso!';
        }

        function getFormButtonText(formType) {
            const buttons = {
                whatsapp: 'Enviar Solicita√ß√£o',
                duvidas: 'Enviar D√∫vida',
                relatorios: 'Enviar Relat√≥rio',
                promocao: 'Enviar Solicita√ß√£o',
                denuncia: 'Enviar Den√∫ncia'
            };
            return buttons[formType] || 'Enviar';
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                const formType = event.target.id.replace('modal-', '');
                closeFormModal(formType);
            }
        });
    </script>
</body>
</html>
